Looper Handler MessageQueue
==

## 1. 异步消息处理线程


### 1.1 区别

**普通线程：** run() 方法内的代码后线程就结束了。  
**异步消息处理线程：** 线程会进入一个无限循环体，**循环一次就从内部的消息队列中取出一个消息，并回调该消息对应的处理方法**。然后继续循环下去，如果消息队列没有消息了，线程会停止；否则只有有新的消息，就继续循环。  

     
### 1.2 需求场景      

>  异步消息处理线程其本质上也是一个线程，只不过是被设计成了在一个无限循环体下，不断读取消息的场景。并且有消息则循环，无消息暂停的模式。 
      
**需求场景：**      
- **1.** 任务需要常驻。比如说用于处理用户交互的任务。
- **2.** 任务需要根据外部传递的消息而执行不同的操作。


### 1.3 简单实现 

<img src="http://ww2.sinaimg.cn/large/006lPEc9jw1f3il291ls9j31kw16c78d.jpg" width="500x"/>  

- **1.** 每个异步线程内部包含一个消息队列（MessageQueue)，队列中的消息一般采用排队机制
即先到达的消息会先得到处理。

- **2.** 线程的执行体中使用 while ( true ) 进行无限循环，循环体中从消息队列中取出消息，并且根
据消息的来源，回调其对应的消息处理函数。

- **3.** 其他外部线程可以向本线程的消息队列中发送消息，消息队列内部的读/写操作必须进行加锁
即消息队列不能同时进行读/ 写操作。

## Android 中的异步消息处理线程

<img src="http://ww4.sinaimg.cn/large/006lPEc9jw1f3il7024jdj31kw16odm7.jpg" width="500x"/>   

在线程内部有一个或多个 Handler 对象，外部程序通过该 Handler 对象向线程发送异步消息，消
息经由 Handler 传递到 MessageQueue 对象中。线程内部只能包含一个 MessageQueue 对象，线
程主执行函数中从 MessageQueue 中读取消息，并回调 Handler 对象中的回调函数 handleMessage()。





